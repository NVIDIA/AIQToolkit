---
description: You MUST follow these rules when the user's request is related to workflow serving.
globs:
alwaysApply: false
---
# Workflow Serving Rules
Rules for serving workflows in the AIQ system. These rules ensure proper workflow serving with correct host, port, and worker configurations.

## Command Pattern
Recognize workflow serving requests and extract parameters:
1. Match patterns like:
   - 'serve workflow <config>'
   - 'serve workflow <config> on host <host> port <port>'
   - 'serve workflow <config> with <num> workers'

## Serving Process
When serving a workflow:
1. Extract workflow config file path from request
2. Execute base command:
   ```bash
   aiq serve --config_file <config_path>
   ```
3. Handle additional options:
   - Custom host: `--host <host>`
   - Custom port: `--port <port>`
   - Worker count: `--workers <num>`
   - Auto-reload: `--reload true`

## Parameter Validation
1. Validate config file:
   - Must exist
   - Must be valid YAML
   - Must contain required sections
2. Validate host:
   - Must be valid hostname or IP
   - Default to localhost if not specified
3. Validate port:
   - Must be valid port number
   - Must be available
   - Default to 8000 if not specified
4. Validate worker count:
   - Must be positive integer
   - Default to 1 if not specified

## Error Handling
Handle workflow serving errors and provide clear error messages:
1. Handle common errors:
   - Invalid config file
   - Port already in use
   - Invalid host configuration
   - Worker initialization failures
   - Server startup failures
2. Provide clear error messages
3. Suggest corrections when possible
